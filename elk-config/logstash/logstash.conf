# Logstash configuration file to parse logs from services and send them to Elasticsearch

input {
    # File input for NGINX logs
    file {
        path => "/var/log/nginx/*.log"
        start_position => "beginning"
        sincedb_path => "/dev/null"
    }
    # File input for Elysia logs
    file {
        path => "/var/log/elysia/*.log"
        start_position => "beginning"
        sincedb_path => "/dev/null"
    }
}

filter {
    # Conditional filter for NGINX logs
    if [path] =~ "nginx" {
        json {
            source => "message"
        }
        date {
            match => ["timestamp", "ISO8601"]
        }
    }
    # Conditional filter for Elysia logs
    else if [path] =~ "elysia" {
        json {
            source => "message"
        }
        date {
            match => ["timestamp", "ISO8601"]
        }
    }
}

output {
    # Output to Elasticsearch
    elasticsearch {
        hosts => ["elasticsearch:9200"]
        index => "%{[service]}-logs-%{+YYYY.MM.dd}"
    }

    # Output to stdout for debugging purposes
    stdout { codec => rubydebug }
}
